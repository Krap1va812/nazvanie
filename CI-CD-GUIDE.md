# üöÄ CI/CD Configuration Guide

## –ß—Ç–æ —Ç–∞–∫–æ–µ CI/CD?

**CI/CD** - —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:
- **CI (Continuous Integration)** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ
- **CD (Continuous Deployment)** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

## üìã –ß—Ç–æ –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

–°–æ–∑–¥–∞–Ω–æ 2 GitHub Actions workflow:

### 1. `ci-cd.yml` - –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ main/master
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ pull request
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ 7 —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (pytest)
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É docker-compose

### 2. `docker-push.yml` - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤
- ‚úÖ –ü—É—à–∏—Ç –æ–±—Ä–∞–∑—ã –≤ Docker Hub –ø—Ä–∏ push –≤ main
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç–µ–≥–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–î–ª—è —Ä–∞–±–æ—Ç—ã Docker Hub push –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:

1. –ü–µ—Ä–µ–π–¥–∏ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. –î–æ–±–∞–≤—å –¥–≤–∞ —Å–µ–∫—Ä–µ—Ç–∞:
   - `DOCKERHUB_USERNAME` - —Ç–≤–æ–π –ª–æ–≥–∏–Ω –Ω–∞ Docker Hub
   - `DOCKERHUB_TOKEN` - —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ Docker Hub

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Docker Hub Token:
1. –ó–∞–π–¥–∏ –Ω–∞ https://hub.docker.com/
2. **Account Settings** ‚Üí **Security** ‚Üí **New Access Token**
3. –°–∫–æ–ø–∏—Ä—É–π —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å –≤ GitHub Secrets

## üìä –°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –¥–æ–±–∞–≤—å –±–µ–π–¥–∂ –≤ README.md:

```markdown
![CI/CD](https://github.com/–≤–∞—à-username/–≤–∞—à-repo/actions/workflows/ci-cd.yml/badge.svg)
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –∫–∞–∂–¥–æ–º push:

```
1. GitHub –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥
   ‚Üì
2. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã (pytest) –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   ‚Üì
3. –°–æ–±–∏—Ä–∞—é—Ç—Å—è Docker –æ–±—Ä–∞–∑—ã
   ‚Üì
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è docker-compose
   ‚Üì
5. (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—É—à–∞—Ç—Å—è –≤ Docker Hub
   ‚Üì
6. ‚úÖ –£—Å–ø–µ—Ö –∏–ª–∏ ‚ùå –û—à–∏–±–∫–∞
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ü–æ—Å–ª–µ push –≤ GitHub:

1. –ü–µ—Ä–µ–π–¥–∏ –≤ **Actions** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. –£–≤–∏–¥–∏—à—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ workflow
3. –ö–ª–∏–∫–Ω–∏ –Ω–∞ workflow —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
4. –ö–∞–∂–¥—ã–π —à–∞–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

```yaml
.github/
‚îî‚îÄ‚îÄ workflows/
    ‚îú‚îÄ‚îÄ ci-cd.yml          # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω (—Ç–µ—Å—Ç—ã + —Å–±–æ—Ä–∫–∞)
    ‚îî‚îÄ‚îÄ docker-push.yml    # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Docker Hub
```

## üí° –ß—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- Code linting (flake8, black)
- Security scanning (Snyk, Trivy)
- Code coverage –æ—Ç—á–µ—Ç—ã

### Deployment:
- Deploy –Ω–∞ AWS/Azure/GCP
- Deploy –Ω–∞ Kubernetes
- Deploy —á–µ—Ä–µ–∑ SSH –Ω–∞ VPS

### –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è deploy –Ω–∞ VPS:

```yaml
deploy:
  name: Deploy to VPS
  runs-on: ubuntu-latest
  needs: build
  
  steps:
    - name: Deploy via SSH
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USERNAME }}
        key: ${{ secrets.VPS_SSH_KEY }}
        script: |
          cd /opt/labmakeev
          git pull
          docker compose down
          docker compose up -d
```

## ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ CI/CD

–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è:
- ‚úÖ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ Docker —Å–ª–æ–µ–≤
- ‚úÖ Build –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub Actions, —Ç—ã –±—É–¥–µ—à—å –ø–æ–ª—É—á–∞—Ç—å:
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Å–±–æ—Ä–∫–∏
- –°—Ç–∞—Ç—É—Å –≤ pull request
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ Actions

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ push:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest monolith/tests/ services/*/tests/ -v

# –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –æ–±—Ä–∞–∑—ã
docker compose build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫
docker compose up -d
docker compose ps
docker compose down
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ main:
1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã
2. ‚úÖ –°–æ–±–∏—Ä–∞—é—Ç—Å—è Docker –æ–±—Ä–∞–∑—ã
3. ‚úÖ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ Docker Hub
4. ‚úÖ –ì–æ—Ç–æ–≤—ã –∫ deployment

–ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–π `git push` –∏ –Ω–∞–±–ª—é–¥–∞–π –º–∞–≥–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏! üöÄ
